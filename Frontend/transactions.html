<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CBS â€“ Transactions</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    rel="stylesheet"
  />
  <style>
    :root {
      --primary-bg: #f8f9fa;
      --card-bg: #ffffff;
      --shadow: 0 4px 20px rgba(0,0,0,0.05);
      --accent: #4a90e2;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
    }

    body {
      background-color: var(--primary-bg);
      font-family: 'Segoe UI', sans-serif;
    }

    h2, h4 {
      color: #333;
    }

    .card {
      background-color: var(--card-bg);
      box-shadow: var(--shadow);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .btn-primary {
      background-color: var(--accent);
      border-color: var(--accent);
    }

    .btn-primary:hover {
      background-color: #3a78c2;
      border-color: #3a78c2;
    }

    .btn-success {
      background-color: var(--success);
      border-color: var(--success);
    }

    .btn-warning {
      background-color: var(--warning);
      border-color: var(--warning);
    }

    .btn-danger {
      background-color: var(--danger);
      border-color: var(--danger);
    }

    #result {
      background-color: var(--card-bg);
      padding: 20px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      color: #333;
    }

    input::placeholder {
      color: #999;
    }

    .form-label b {
      color: #555;
    }

    .section-title {
      border-bottom: 2px solid var(--accent);
      display: inline-block;
      padding-bottom: 5px;
      margin-bottom: 20px;
    }
  </style>
</head>

<body class="p-4">

  <h2 class="mb-4">CBS Transaction Operations</h2>

  <!-- Operator Card -->
  <div class="card">
    <h4 class="section-title">Operator</h4>
    <div class="mb-3">
      <label class="form-label"><b>Operator Name</b></label>
      <input
        id="operator"
        class="form-control"
        placeholder="Enter operator (e.g., Muhammad Talha)"
      />
    </div>
  </div>

  <!-- Deposit Card -->
  <div class="card">
    <h4 class="section-title">Deposit</h4>
    <form id="depositForm">
      <div class="row g-3">
        <div class="col-md-4">
          <input id="depAccount" class="form-control" placeholder="Account No" />
        </div>
        <div class="col-md-4">
          <input id="depAmount" class="form-control" placeholder="Amount" type="number" />
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button class="btn btn-primary w-100"><i class="fas fa-arrow-down me-2"></i>Deposit</button>
        </div>
      </div>
    </form>
  </div>

  <!-- Withdraw Card -->
  <div class="card">
    <h4 class="section-title">Withdraw</h4>
    <form id="withdrawForm">
      <div class="row g-3">
        <div class="col-md-4">
          <input id="wdAccount" class="form-control" placeholder="Account No" />
        </div>
        <div class="col-md-4">
          <input id="wdAmount" class="form-control" placeholder="Amount" type="number" />
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button class="btn btn-warning w-100"><i class="fas fa-arrow-up me-2"></i>Withdraw</button>
        </div>
      </div>
    </form>
  </div>

  <!-- Transfer Card -->
  <div class="card">
    <h4 class="section-title">Transfer</h4>
    <form id="transferForm">
      <div class="row g-3">
        <div class="col-md-4">
          <input id="fromAcc" class="form-control" placeholder="From Account" />
        </div>
        <div class="col-md-4">
          <input id="toAcc" class="form-control" placeholder="To Account" />
        </div>
        <div class="col-md-4">
          <input id="trAmount" class="form-control" placeholder="Amount" type="number" />
        </div>
        <div class="col-md-12 d-flex justify-content-end mt-3">
          <button class="btn btn-success"><i class="fas fa-exchange-alt me-2"></i>Transfer</button>
        </div>
      </div>
    </form>
  </div>

  <!-- Result Display -->
  <div id="result" class="mt-4"></div>

  <script>
    async function api(path, data) {
      const res = await fetch("/api/transactions/" + path, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });
      return res.json();
    }

    const resultEl = document.getElementById("result");

    // ----------------------- DEPOSIT -----------------------
    document.getElementById("depositForm").onsubmit = async (e) => {
      e.preventDefault();
      const operator = document.getElementById("operator").value || "system";
      const accountNo = depAccount.value;
      const amount = parseFloat(depAmount.value);

      const res = await api("deposit", { accountNo, amount, user: operator });

      if (res.success && res.receiver) {
        resultEl.innerHTML = `
          <strong>Deposit Completed</strong><br>
          Receiver: ${res.receiver.name} (Acc #${res.receiver.accountNo})<br>
          New Balance: ${res.receiver.newBalance}
        `;
      } else {
        resultEl.innerText = "Error: " + (res.error || "Unknown error");
      }
    };

    // ----------------------- WITHDRAW -----------------------
    document.getElementById("withdrawForm").onsubmit = async (e) => {
      e.preventDefault();
      const operator = document.getElementById("operator").value || "system";
      const accountNo = wdAccount.value;
      const amount = parseFloat(wdAmount.value);

      const res = await api("withdraw", { accountNo, amount, user: operator });

      if (res.success && res.sender) {
        resultEl.innerHTML = `
          <strong>Withdrawal Completed</strong><br>
          Sender: ${res.sender.name} (Acc #${res.sender.accountNo})<br>
          New Balance: ${res.sender.newBalance}
        `;
      } else {
        resultEl.innerText = "Error: " + (res.error || "Unknown error");
      }
    };

    // ----------------------- TRANSFER -----------------------
    document.getElementById("transferForm").onsubmit = async (e) => {
      e.preventDefault();
      const operator = document.getElementById("operator").value || "system";
      const fromAccount = fromAcc.value;
      const toAccount = toAcc.value;
      const amount = parseFloat(trAmount.value);

      const res = await api("transfer", { fromAccount, toAccount, amount, user: operator });

      if (res.success && res.sender && res.receiver) {
        resultEl.innerHTML = `
          <strong>Transfer Completed</strong><br><br>
          <b>Sender:</b> ${res.sender.name} (Acc #${res.sender.accountNo})<br>
          New Balance: ${res.sender.newBalance}<br><br>
          <b>Receiver:</b> ${res.receiver.name} (Acc #${res.receiver.accountNo})<br>
          New Balance: ${res.receiver.newBalance}<br>
        `;
      } else {
        resultEl.innerText = "Error: " + (res.error || "Unknown error");
      }
    };
  </script>
</body>
</html>
